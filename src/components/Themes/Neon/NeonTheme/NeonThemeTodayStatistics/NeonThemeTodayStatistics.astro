---
// This component displays the number of orders placed "today" for the Neon theme.
// It features an animated counter that counts up to the provided order number.
// Props:
// - data: An object of type BlockData, expected to contain `counters` array.
import "./NeonThemeTodayStatistics.css";
import type { BlockData, Item } from "../../../../../lib/api/types";
import { FunnelNeonComponents } from "../../../../../lib/constants/themes";
import type { Language } from "../../../../../lib/utils/i18n/translations";
import LucideIcon from "../../../../Shared/LucideIcon.astro";

const data: BlockData = Astro.props.data;
const counters: Item[] = data.items ?? [];

// Get initial language from cookie during SSR
const currentLang: Language = (Astro.cookies.get("lang")?.value || "ar") as Language;
const isArabic = currentLang === "ar";

const total = counters.reduce((sum, counter) => sum + Number(counter.number || 0), 0);

const getProgressPercentage = (value: number): number => {
  if (total === 0) return 0;
  return (value / total) * 100;
};
---

<neon-statistics-counter>
  
<section id={FunnelNeonComponents.NeonTodayStatistics} class="neon-section">
  <div class="neon-middle-title">
    <h3>
      {isArabic ? data.title_ar : data.title_en}
    </h3>
    <div class="neon-divider mx-auto rounded-full"></div>
  </div>

  <!-- Statistics List - Variation 3: Horizontal Progress Style -->
  <div class="neon-statistics-list py-8 md:py-12 space-y-6 md:space-y-8 max-w-4xl mx-auto">
    {
      counters.map((counter) => {
        const progressPercentage = getProgressPercentage(counter.number || 0);
        return (
          <div class="neon-statistics-row flex items-center gap-4 md:gap-6 p-4 md:p-6 rounded-2xl transition-all duration-300 hover:scale-105">
            <!-- Icon -->
            <div class="neon-statistics-icon w-12 h-12 md:w-16 md:h-16 rounded-lg flex items-center justify-center flex-shrink-0">
                  <LucideIcon name={counter.icon as any} width="20" height="20" class="neon-statistics-icon-symbol md:w-6 md:h-6" /> :
            </div>

            <!-- Content -->
            <div class="neon-statistics-content flex-1">
              <!-- Label and Number -->
              <div class="flex justify-between items-center mb-2">
                <span class="neon-statistics-label text-base md:text-lg font-bold">
                  {counter.label}
                </span>
                <span class="neon-order-counter text-2xl md:text-3xl font-black" data-target={counter.number}>
                  +0
                </span>
              </div>

              <!-- Progress Bar -->
              <div class="neon-statistics-progress-bg w-full h-2 rounded-full overflow-hidden">
                <div 
                  class="neon-statistics-progress-fill h-2 rounded-full transition-all duration-1000 ease-out"
                  style={`width: ${progressPercentage}%`}
                ></div>
              </div>
            </div>
          </div>
        );
      })
    }
  </div>
</section>
</neon-statistics-counter>

<script>
  import "./NeonThemeTodayStatistics";
</script>