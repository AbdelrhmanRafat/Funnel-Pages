---
import "./neonBefore&After.css"
import type { BlockData, Item } from "../../../../../lib/api/types";
import type { Language } from "../../../../../lib/utils/i18n/translations";
import NeonBuyNowButton from "../UI/NeonBuyNowButton/NeonBuyNowButton.astro";
import { FunnelNeonComponents } from "../../../../../lib/constants/themes";

// Get initial language from cookie during SSR
const currentLang: Language = (Astro.cookies.get("lang")?.value || "ar") as Language;
const isArabic = currentLang === "ar";

const data: BlockData = Astro.props.data;
const items: Item[] = data.items ?? [];

const beforeItemData: Item | undefined = items.find(item => item.name?.toLocaleLowerCase() == "before");
const afterItemData: Item | undefined = items.find(item => item.name?.toLocaleLowerCase() == "after");
---
<section 
  id={FunnelNeonComponents.Neon_Before_After}
  class="neon-section py-12 px-4 sm:px-6 lg:px-12"
  aria-labelledby="before-after-heading"
>
  <!-- Section Header -->
  <header class="neon-middle-title">
    <h2 id="before-after-heading">
      {isArabic ? data.title_ar : data.title_en}
    </h2>
    <p class="text-base sm:text-lg font-medium neon-before-after-section-description max-w-2xl">
      {data.description}
    </p>
    <div class="neon-divider rounded-full" role="presentation"></div>
  </header>

  <!-- Before & After Vertical Card -->
  <article class="flex flex-col gap-14 items-center max-w-4xl mx-auto mt-10">
    
    <!-- Before Section -->
    <div class="flex flex-col gap-4 w-full">
      <div class="flex flex-col items-start gap-2 px-2">
        <h3 class="text-lg sm:text-xl font-semibold neon-before-after-card-title">
          {beforeItemData?.label}
        </h3>
        <p class="text-sm sm:text-base neon-before-after-card-description max-w-3xl">
          {beforeItemData?.content}
        </p>
      </div>
      <figure class="relative w-full h-64 md:h-96 aspect-[4/5] overflow-hidden rounded-lg neon-before-after-image-card shadow-lg">
        <img 
          src={beforeItemData?.image}
          alt={beforeItemData?.label || "Before image"}
          class="absolute inset-0 w-full h-full object-cover"
          loading="lazy"
        />
      </figure>
    </div>

    <!-- After Section -->
    <div class="flex flex-col gap-4 w-full">
      <div class="flex flex-col items-start gap-2 px-2">
        <h3 class="text-lg sm:text-xl font-semibold neon-before-after-card-title">
          {afterItemData?.label}
        </h3>
        <p class="text-sm sm:text-base neon-before-after-card-description max-w-3xl">
          {afterItemData?.content}
        </p>
      </div>
      <figure class="relative w-full h-64 md:h-96 aspect-[4/5] overflow-hidden rounded-lg neon-before-after-image-card shadow-lg">
        <img 
          src={afterItemData?.image}
          alt={afterItemData?.label || "After image"}
          class="absolute inset-0 w-full h-full object-cover"
          loading="lazy"
        />
      </figure>
    </div>
  </article>

  <!-- CTA Button -->
  <div class="flex justify-center mt-12">
    <NeonBuyNowButton />
  </div>
</section>
