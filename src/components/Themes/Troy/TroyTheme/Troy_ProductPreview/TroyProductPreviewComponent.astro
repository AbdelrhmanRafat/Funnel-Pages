---
// This component renders a preview of the product for the troy theme.
// Props:
// - data: An object of type BlockData, containing product preview information.
import "./troyProductPreviewComponent.css"
import type { BlockData, ProductPreview } from "../../../../../lib/api/types";
import troyBuyNowButton from "../UI/troyBuyNowButton/troyBuyNowButton.astro";
import { FunneltroyComponents } from "../../../../../lib/constants/themes";

const data: BlockData = Astro.props.data;
const productPreview: ProductPreview = data.productPreview ?? {} as ProductPreview;
console.log(productPreview.videoInfo.link);
---
<section id={FunneltroyComponents.troyProductPreview} class="troy-section">
    <!-- Header -->
    <div class="troy-section-header">
        <i class={data.icon}></i>
        <h5>{data.title}</h5>
    </div>
    <!-- Main Content -->
    <div class="flex flex-col lg:flex-row gap-6 lg:gap-8 items-stretch">
        <!-- Video Section (3/5 width on desktop) -->
        <div class="w-full lg:w-3/5 order-2 lg:order-1">
            <div class="troy-product-video-container troy-product-video-height border-4 overflow-hidden relative">
                <iframe
                    class="w-full h-full rounded-[inherit]"
                    src={productPreview.videoInfo.link}
                    title="YouTube video player"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen>
                </iframe>
                <div class="troy-product-video-title absolute bottom-9 right-2 text-3xl font-bold z-10">
                    <p>{productPreview.videoInfo.title}</p>
                </div>
            </div>
        </div>
                
        <!-- Features Section (2/5 width on desktop) -->
        <div class="w-full lg:w-2/5 order-1 lg:order-2">
            <div class="troy-product-features-container h-full flex flex-col rounded-xl p-6">
                <!-- Features Header -->
                <div class="troy-product-features-header border-b pb-3">
                    <div class="flex flex-col gap-3 sm:flex-row sm:justify-between sm:items-center sm:gap-4">
                        <h2 class="troy-product-features-title text-2xl font-bold">
                            {productPreview.featuresSectionTitle}
                        </h2>
                        <div class="troy-product-views-badge flex-shrink-0 py-1 px-4 rounded-2xl flex items-center gap-2 text-lg max-w-full">
                            <div class="flex-shrink-0">
                                <i class={productPreview.viewsIcon}></i>
                            </div>
                            <span class="truncate">{productPreview.viewsText}</span>
                        </div>
                    </div>
                </div>
                                
                <!-- Feature List -->
                <div class="flex-1 py-6">
                    <div class="space-y-6 lg:space-y-8">
                        {
                            productPreview.features.map((feature) => (
                                <div class="troy-product-feature-item flex items-start gap-3">
                                    <div class="troy-product-feature-icon rounded-full p-2 flex-shrink-0 flex items-center justify-center mt-0.5">
                                        <i class="fa-solid fa-circle-check"></i>
                                    </div>
                                    <div class="troy-product-feature-content flex-1 min-w-0 text-right">
                                        <div class="troy-product-feature-title font-semibold leading-snug">{feature.title}</div>
                                        <div class="troy-product-feature-subtitle text-sm leading-snug mt-1">
                                            {feature.subtitle}
                                        </div>
                                    </div>
                                </div>
                            ))
                        }
                    </div>
                </div>
                                
                <!-- Buy Now Button -->
                <div class="mt-auto pt-4 border-t border-current/10">
                    <troyBuyNowButton />
                </div>
            </div>
        </div>
    </div>
</section>