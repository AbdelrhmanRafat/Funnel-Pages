---
import "@fontsource/tajawal/300.css";
import "@fontsource/tajawal/400.css";
import "@fontsource/tajawal/500.css";
import "@fontsource/tajawal/700.css";
import "@fontsource/tajawal/800.css";
import "@fontsource/tajawal/900.css";

import "../../../styles/global.css";
import "./Styles/ClassicThemeStyle.css";

import ClassicThemeProduct from "./ClassicTheme/ClassicThemeProduct.astro";
import ClassicThemeHeader from "./ClassicTheme/ClassicThemeHeader.astro";
import ClassicThemeCountDown from "./ClassicTheme/ClassicThemeCountDown.astro";
import ClassicThemeFormFields from "./ClassicTheme/ClassicThemeFormFields.astro";
import ClassicThemeTodayOrders from "./ClassicTheme/ClassicThemeTodayOrders.astro";
import ClassicThemeProductFunnel from "./ClassicTheme/ClassicThemeProductFunnel.astro";
import ClassicThemeFooter from "./ClassicTheme/ClassicThemeFooter.astro";
import { FunnelClassicComponents } from '../../../Interfaces/Themes';
import type { Data, BlockData } from "../../../Interfaces/Products";
import { getClassicThemeComponent } from "../../../Services/ThemesSelectService";
import ClassicThemeRates from "./ClassicTheme/ClassicThemeRates.astro";

interface ComponentCheckResult {
  isComponentFound: boolean;
  componentData: BlockData | undefined;
}

const funnelPage = (Astro.props as { funnelPage: Data }).funnelPage;

const classicComponentNames: [FunnelClassicComponents, BlockData][] = funnelPage.blocks
  .map(block => {
    const component = getClassicThemeComponent(block.name);
    return component ? [component, block.data] : undefined;
  })
  .filter((tuple): tuple is [FunnelClassicComponents, BlockData] => tuple !== undefined);

function isComponentFound(componentName: FunnelClassicComponents): ComponentCheckResult {
  const found = classicComponentNames.find(([comp]) => comp === componentName);
  return {
    isComponentFound: !!found,
    componentData: found?.[1]
  };
}

---

{isComponentFound(FunnelClassicComponents.ClassicHeader).isComponentFound && (
  <ClassicThemeHeader data={isComponentFound(FunnelClassicComponents.ClassicHeader).componentData} />
)}

{isComponentFound(FunnelClassicComponents.ClassicCountdown).isComponentFound && (
  <ClassicThemeCountDown data={isComponentFound(FunnelClassicComponents.ClassicCountdown).componentData} />
)}

<main class="container mx-auto px-4 py-12 bg-cream">

<div class="grid lg:grid-cols-2 gap-8">
<ClassicThemeProduct Product={funnelPage}></ClassicThemeProduct>
{isComponentFound(FunnelClassicComponents.ClassicFormFields).isComponentFound && (
  <ClassicThemeFormFields data={isComponentFound(FunnelClassicComponents.ClassicFormFields).componentData} />
)}
</div>

{isComponentFound(FunnelClassicComponents.ClassicTodayOrders).isComponentFound && (
  <ClassicThemeTodayOrders data={isComponentFound(FunnelClassicComponents.ClassicTodayOrders).componentData} />
)}

{isComponentFound(FunnelClassicComponents.ClassicRates).isComponentFound && (
  <ClassicThemeRates data={isComponentFound(FunnelClassicComponents.ClassicRates).componentData} />
)}


{isComponentFound(FunnelClassicComponents.ClassicProductFunnel).isComponentFound && (
  <ClassicThemeProductFunnel data={isComponentFound(FunnelClassicComponents.ClassicProductFunnel).componentData} />
)}
  </main>

{isComponentFound(FunnelClassicComponents.ClassicFooter).isComponentFound && (
  <ClassicThemeFooter data={isComponentFound(FunnelClassicComponents.ClassicFooter).componentData} />
)}