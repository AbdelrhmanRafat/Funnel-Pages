---

// Get language from localStorage during SSR
const currentLang: string = "en"; // Default value for SSR
const isArabic = false; // Default value for SSR
---

<div class="flex justify-end">
  <button
    id="langToggleBtn"
    class="p-1 text-xs rounded-full hover:bg-gray-100 focus:outline-none"
    aria-label="Switch language"
  >
    <span class="text-xs font-medium" id="langText">EN</span>
  </button>
</div>

<script>
  import { initTranslations } from "../../../../../../lib/utils/i18n/client";

  document.addEventListener("DOMContentLoaded", () => {
    const langToggleBtn = document.getElementById("langToggleBtn");
    const langText = document.getElementById("langText");

    if (langToggleBtn && langText) {
      // Get initial language from localStorage
      const currentLang = localStorage.getItem("lang") || "en";
      const isArabic = currentLang === "ar";

      // Set initial button state
      langText.textContent = isArabic ? "عربي" : "EN";
      langToggleBtn.setAttribute(
        "aria-label",
        isArabic ? "Switch to English" : "التبديل إلى العربية",
      );

      langToggleBtn.addEventListener("click", (e) => {
        e.preventDefault();

        const newLang = currentLang === "en" ? "ar" : "en";

        // Save to localStorage
        localStorage.setItem("lang", newLang);

        // Update URL query param
        const url = new URL(window.location.href);
        url.searchParams.set("lang", newLang);

        // Visual feedback
        langToggleBtn.classList.add("opacity-60", "scale-95");

        // Redirect with new lang
        setTimeout(() => {
          window.location.href = url.toString();
        }, 150);
      });
    }
  });

  initTranslations();
</script>
