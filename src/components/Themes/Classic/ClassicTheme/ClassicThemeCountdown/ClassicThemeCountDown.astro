---
// This component displays a countdown timer for the Classic theme.
// It takes hours, minutes, and seconds from the API data and renders a visual timer.
// Props:
// - data: An object of type BlockData, containing the countdown timer values (hours, minutes, seconds).
import type { BlockData } from "../../../../../lib/api/types";
import { getTranslation } from "../../../../../lib/utils/i18n/translations";

const data: BlockData = Astro.props.data;
let totalSeconds = 0;

// Calculate the total seconds from the provided hours, minutes, and seconds.
if(data.hours != null && data.minutes != null && data.seconds != null)
{
  totalSeconds =
  (parseInt(data.hours?.toString() || '0') || 0) * 3600 +
  (parseInt(data.minutes?.toString() || '0' ) || 0) * 60 +
  (parseInt(data.seconds.toString() || '0' ) || 0);
}
---

<!-- Elegant Countdown Timer with proper spacing for fixed header -->
<section class="classic-countDown text-black relative">
  <!-- Add padding-top to account for fixed header when positioned at top -->
  <div class="px-6 text-center countdown-container">
    <h2 class="text-3xl font-bold" data-translate="countdown.offerEndsIn">
      {getTranslation('countdown.offerEndsIn')}
    </h2>
    
    <div
      class="my-7 flex justify-center gap-4 sm:gap-8 items-center"
      id="countdown"
      data-time={totalSeconds}
    >
      {/* Hours display block */}
      <div
        class="bg-cream text-burgundy rounded-2xl px-6 py-5 min-w-[80px] border-2 border-gold shadow-xl transition duration-300 hover:shadow-2xl hover:scale-105"
      >
        <div class="text-4xl font-extrabold" id="hours">--</div>
        <div class="text-sm font-serif" data-translate="countdown.hours">
          {getTranslation('countdown.hours')}
        </div>
      </div>
      {/* Minutes display block */}
      <div
        class="bg-cream text-burgundy rounded-2xl px-6 py-5 min-w-[80px] border-2 border-gold shadow-xl transition duration-300 hover:shadow-2xl hover:scale-105"
      >
        <div class="text-4xl font-extrabold" id="minutes">--</div>
        <div class="text-sm font-serif" data-translate="countdown.minutes">
          {getTranslation('countdown.minutes')}
        </div>
      </div>
      {/* Seconds display block */}
      <div
        class="bg-cream text-burgundy rounded-2xl px-6 py-5 min-w-[80px] border-2 border-gold shadow-xl transition duration-300 hover:shadow-2xl hover:scale-105"
      >
        <div class="text-4xl font-extrabold" id="seconds">--</div>
        <div class="text-sm font-serif" data-translate="countdown.seconds">
          {getTranslation('countdown.seconds')}
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  import { initCountdown } from "./ClassicThemeCountDown";
  
  // Initialize countdown timer when DOM is loaded
  document.addEventListener('DOMContentLoaded', () => {
    // Start the countdown timer
    initCountdown();
    
    // Handle positioning relative to header
    const countdownSection = document.querySelector('.classic-countDown');
    const countdownContainer = document.querySelector('.countdown-container');
    
    if (countdownSection && countdownContainer) {
      const prevSibling = countdownSection.previousElementSibling;
      if (!prevSibling || prevSibling.tagName === 'HEADER') {
        countdownContainer.classList.add('after-header');
      }
    }
  });
</script>