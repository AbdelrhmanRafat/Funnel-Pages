---
import "./ClassicThemeFormFields.css";
import {
  getTranslation,
  type Language,
} from "../../../../../lib/utils/i18n/translations";
import type { BlockData, PaymentOption } from "../../../../../lib/api/types";
import ClassicSubmitOrderButton from "../UI/ClassicSubmitOrderButton/ClassicSubmitOrderButton.astro";

const data: BlockData = Astro.props.data;
// Get initial language from cookie during SSR
const currentLang: Language = (Astro.cookies.get("lang")?.value ||
  "en") as Language;
const isArabic = currentLang === "ar";
let cities: string[] = [];
let paymentOptions: PaymentOption[] = [];
if (data.cities !== null) cities = data.cities ?? [];
if (data.PaymentOptions !== null) paymentOptions = data.PaymentOptions ?? [];
---

<section id="classic-form" class="classic-form">
  <div class="mx-auto flex flex-col justify-center items-center gap-2">
    <div class="text-center">
      <h5 class="classic-form-title" data-translate="form.completeOrder">
        {getTranslation("form.completeOrder")}
      </h5>
    </div>

    <form class="w-full">
      <div class="mb-8">
        <h2
          class="classic-form-section-title mb-6"
          data-translate="form.personalInfo"
        >
          {getTranslation("form.personalInfo")}
        </h2>
        <div class="space-y-4">
          <div>
            <label
              class="classic-form-label block mb-2"
              data-translate="form.fullName"
            >
              {getTranslation("form.fullName")}
            </label>
            <input
              type="text"
              id="form-fullName"
              placeholder={data.full_name}
              class="classic-form-input text-right"
            />
            <span
              id="form-fullName-error"
              class="classic-form-error"
              style="display: none;"></span>
          </div>

          <div>
            <label
              class="classic-form-label block mb-2"
              data-translate="form.phoneNumber"
            >
              {getTranslation("form.phoneNumber")}
            </label>
            <input
              type="tel"
              id="form-phone"
              placeholder={data.phone}
              class="classic-form-input text-right"
            />
            <span
              id="form-phone-error"
              class="classic-form-error"
              style="display: none;"></span>
          </div>

          <div>
            <label
              class="classic-form-label block mb-2"
              data-translate="form.email"
            >
              {getTranslation("form.email")}
            </label>
            <input
              type="email"
              id="form-email"
              placeholder={getTranslation("form.enterEmail")}
              class="classic-form-input text-right"
            />
            <span
              id="form-email-error"
              class="classic-form-error"
              style="display: none;"></span>
          </div>

          <div>
            <label
              class="classic-form-label block mb-2"
              data-translate="form.city"></label>
            <select id="form-city" class="classic-form-input text-right">
              <option value="" data-translate="form.selectCity"></option>

              {
                cities.map((city: string) => (
                  <option value={city.toLowerCase().replace(/\s+/g, "")}>
                    {city}
                  </option>
                ))
              }
            </select>

            <span
              id="form-city-error"
              class="classic-form-error"
              style="display: none;"></span>
          </div>

          <!-- Payment Options -->
          <div>
            <label
              class="classic-form-label block mb-2"
              data-translate="form.paymentOptions"
            >
            </label>
            <div
              class="space-y-3"
              role="radiogroup"
              aria-label="Payment Method"
            >
              {
                paymentOptions.map((option, index) => {
                  const value = option.id;
                  const id = `payment-${value}`;
                  const isChecked = index === 0;
                  return (
                    <div class="classic-form-delivery-option">
                      <input
                        type="radio"
                        id={id}
                        name="payment-option"
                        value={value}
                        class="classic-form-radio"
                        checked={isChecked}
                      />
                      <label
                        for={id}
                        class="classic-form-delivery-option-content"
                      >
                        <div class="flex justify-between items-center">
                          <div class="flex-1  flex flex-col justify-start items-start gap-2">
                            <span class="classic-form-delivery-option-label">
                              {option.label[currentLang]}
                            </span>
                            <span class="classic-form-delivery-option-description">
                              {option.description[currentLang]}
                            </span>

                            {/* Show payment method images if available */}
                            {option.images && option.images.length > 0 && (
                              <div class="flex justify-start items-center flex-wrap gap-4 ">
                                {option.images.map((imageSrc) => (
                                  <div class="w-8 h-8 flex justify-center items-center">
                                  <img
                                    src={imageSrc}
                                    alt={option.label[currentLang]}
                                    class="w-full"
                                  />
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>

                          {/* Custom radio indicator */}
                          <div class="classic-form-radio-indicator">
                            <div class="classic-form-radio-dot" />
                          </div>
                        </div>
                      </label>
                    </div>
                  );
                })
              }
            </div>
            <span
              id="form-payment-error"
              class="classic-form-error"
              style="display: none;"></span>
          </div>

          <!-- Notes Options -->
          <div>
            <label
              class="classic-form-label block mb-2"
              data-translate="form.notes"
            >
              {getTranslation("form.notes")}
            </label>
            <textarea
              id="form-notes"
              data-translate="form.enterNotes"
              class="classic-form-input text-right min-h-[100px] resize-y"
            ></textarea>
            <span
              id="form-notes-error"
              class="classic-form-error"
              style="display: none;"></span>
          </div>
        </div>
      </div>
      <ClassicSubmitOrderButton />
    </form>
  </div>
</section>

<script>
  import "./ClassicThemeFormFields";
</script>
