---
// server-side code
import type { BlockData, VideoInfo } from "../../../../../lib/api/types";

const data: BlockData = Astro.props.data;
const productUsage : VideoInfo[] = data.productUsage;

// Helper function to convert watch URL to embed
const getEmbedUrl = (url: string) => {
  const videoIdMatch = url.match(/v=([^&]+)/);
  return videoIdMatch ? `https://www.youtube.com/embed/${videoIdMatch[1]}` : '';
};
---

<section id="ClassicProductUsage" class="p-5 bg-white rounded-2xl shadow-2xl">
    <!-- Header -->
    <div class="flex justify-start gap-2 items-center mb-6">
        <button class="bg-cyan-500 hover:bg-cyan-600 rounded-full p-2 transition-colors">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
            </svg>
        </button>
        <h5 class="text-3xl font-bold text-black">شاهد كيفية الاستخدام</h5>
    </div>

    <!-- Video Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {
            productUsage.map((video) => (
                <div class="rounded-2xl overflow-hidden bg-gray-500 shadow-md hover:scale-105 transition-transform">
                    <div class="relative">
                        <iframe
                            class="w-full lg:h-[620px] h-[300px]"
                            src={getEmbedUrl(video.link)}
                            title={video.title}
                            frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen
                        ></iframe>
                        <div class="absolute bottom-3 right-3 bg-black bg-opacity-80 px-2 py-1 rounded text-xs text-white flex items-center">
                            <svg class="w-3 h-3 ml-1" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                            </svg>
                            3,210 مشاهدة
                        </div>
                    </div>
                    <div class="p-3">
                        <h3 class="font-medium text-white text-base mb-1">{video.title}</h3>
                        <p class="text-gray-400 text-sm mb-2">{video.subtitle}</p>
                        <div class="flex items-center justify-between text-xs">
                            <span class="flex items-center text-gray-500">
                                <svg class="w-3 h-3 ml-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M15 10a5 5 0 11-10 0 5 5 0 0110 0zm-1 0a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"></path>
                                </svg>
                                مشاركة
                            </span>
                        </div>
                    </div>
                </div>
            ))
        }
    </div>
</section>