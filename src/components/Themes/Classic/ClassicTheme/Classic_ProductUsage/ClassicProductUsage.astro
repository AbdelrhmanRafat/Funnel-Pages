---
// server-side code
import "./ClassicProductUsage.css";
import type { BlockData, VideoInfo } from "../../../../../lib/api/types";

const data: BlockData = Astro.props.data;
const productUsage: VideoInfo[] = data.productUsage;

// Helper function to convert watch URL to embed
const getEmbedUrl = (url: string) => {
    const videoIdMatch = url.match(/v=([^&]+)/);
    return videoIdMatch
        ? `https://www.youtube.com/embed/${videoIdMatch[1]}`
        : "";
};
---
<section id="Classic-product-usage" class="classic-section">
    <!-- Header -->
    <div class="classic-section-header">
        <i class="fa-solid fa-circle-chevron-right"></i>
        <h5>شاهد كيفية الاستخدام</h5>
    </div>
    
    <!-- Video Grid -->
    <div class="classic-usage-grid" style={`grid-template-columns: repeat(${productUsage.length > 3 ? 3 : productUsage.length}, 1fr);`}>
        {
            productUsage.map((video) => (
                <div class="classic-usage-card">
                    <div class="classic-usage-video">
                        <iframe
                            class="classic-usage-iframe"
                            src={getEmbedUrl(video.link)}
                            title={video.title}
                            frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen
                        />
                        <div class="classic-usage-views">
                            <svg
                                class="classic-usage-icon"
                                fill="currentColor"
                                viewBox="0 0 20 20"
                            >
                                <path
                                    fill-rule="evenodd"
                                    d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
                                    clip-rule="evenodd"
                                />
                            </svg>
                            3,210 مشاهدة
                        </div>
                    </div>
                    <div class="classic-usage-content">
                        <h3 class="classic-usage-title">
                            {video.title}
                        </h3>
                        <p class="classic-usage-subtitle">
                            {video.subtitle}
                        </p>
                        <div class="classic-usage-footer">
                            <span class="classic-usage-share">
                                <svg
                                    class="classic-usage-icon"
                                    fill="currentColor"
                                    viewBox="0 0 20 20"
                                >
                                    <path
                                        fill-rule="evenodd"
                                        d="M15 10a5 5 0 11-10 0 5 5 0 0110 0zm-1 0a4 4 0 11-8 0 4 4 0 018 0z"
                                        clip-rule="evenodd"
                                    />
                                </svg>
                                مشاركة
                            </span>
                        </div>
                    </div>
                </div>
            ))
        }
    </div>
</section>
