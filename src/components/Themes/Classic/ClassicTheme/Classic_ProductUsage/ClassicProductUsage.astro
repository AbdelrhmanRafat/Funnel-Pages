---
// server-side code
import type { BlockData, VideoInfo } from "../../../../../lib/api/types";

const data: BlockData = Astro.props.data;
const productUsage: VideoInfo[] = data.productUsage;

// Helper function to convert watch URL to embed
const getEmbedUrl = (url: string) => {
    const videoIdMatch = url.match(/v=([^&]+)/);
    return videoIdMatch
        ? `https://www.youtube.com/embed/${videoIdMatch[1]}`
        : "";
};
---

<section id="Classic-product-usage" class="classic-section">
    <!-- Header -->
    <div class="classic-section-header">
        <i class="fa-solid fa-circle-chevron-right"></i>
        <h5>شاهد كيفية الاستخدام</h5>
    </div>
    <!-- Video Grid -->
    <div class={`grid grid-cols-1 md:grid-cols-${productUsage.length} gap-4`}>
        {
            productUsage.map((video) => (
                <div class="rounded-2xl overflow-hidden bg-gray-500 shadow-md hover:scale-105 transition-transform">
                    <div class="relative">
                        <iframe
                            class="w-full lg:h-[620px] h-[300px]"
                            src={getEmbedUrl(video.link)}
                            title={video.title}
                            frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen
                        />
                        <div class="absolute bottom-3 right-3 bg-black bg-opacity-80 px-2 py-1 rounded text-xs text-white flex items-center">
                            <svg
                                class="w-3 h-3 ml-1"
                                fill="currentColor"
                                viewBox="0 0 20 20"
                            >
                                <path
                                    fill-rule="evenodd"
                                    d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
                                    clip-rule="evenodd"
                                />
                            </svg>
                            3,210 مشاهدة
                        </div>
                    </div>
                    <div class="p-3">
                        <h3 class="font-medium text-white text-base mb-1">
                            {video.title}
                        </h3>
                        <p class="text-gray-400 text-sm mb-2">
                            {video.subtitle}
                        </p>
                        <div class="flex items-center justify-between text-xs">
                            <span class="flex items-center text-gray-500">
                                <svg
                                    class="w-3 h-3 ml-1"
                                    fill="currentColor"
                                    viewBox="0 0 20 20"
                                >
                                    <path
                                        fill-rule="evenodd"
                                        d="M15 10a5 5 0 11-10 0 5 5 0 0110 0zm-1 0a4 4 0 11-8 0 4 4 0 018 0z"
                                        clip-rule="evenodd"
                                    />
                                </svg>
                                مشاركة
                            </span>
                        </div>
                    </div>
                </div>
            ))
        }
    </div>
</section>
